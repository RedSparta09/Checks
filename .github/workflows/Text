import tableauserverclient as TSC

# Tableau Server credentials
server_url = 'YOUR_SERVER_URL'
personal_access_token_name = 'YOUR_ACCESS_TOKEN_NAME'
personal_access_token_secret = 'YOUR_ACCESS_TOKEN_SECRET'
site_id = 'YOUR_SITE_ID'  # Usually an empty string for the default site
project_name = 'YOUR_PROJECT_NAME'
hyper_file_path = 'path_to_your_hyper_file.hyper'
datasource_name = 'YOUR_DATASOURCE_NAME'

# Authenticate with Tableau Server using personal access token
tableau_auth = TSC.PersonalAccessTokenAuth(personal_access_token_name, personal_access_token_secret, site_id)
server = TSC.Server(server_url, use_server_version=True)

with server.auth.sign_in(tableau_auth):
    # Find the project by name
    all_projects, pagination_item = server.projects.get()
    project = next(proj for proj in all_projects if proj.name == project_name)
    
    # Create a new datasource item
    new_datasource = TSC.DatasourceItem(project.id, name=datasource_name)
    
    # Publish the Hyper file as a datasource
    new_datasource = server.datasources.publish(new_datasource, hyper_file_path, TSC.Server.PublishMode.Overwrite)
    
    print(f"Datasource {new_datasource.name} published with id {new_datasource.id}")

